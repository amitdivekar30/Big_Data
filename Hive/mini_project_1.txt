Hive Mini Project: 01

1. Create a schema based on the given dataset
Ans: 
        # create table 
        create table agent_logging
        (
        S_no int,
        Agent string,
        Date string,
        Login_Time string,
        Logout_Time string,
        Duration string
        )
        row format delimited
        fields terminated by ','
        tblproperties("skip.header.line.count"="1")
        ;


        create table agent_loging_report
        (
        S_no int,
        Agent string,
        Date timestamp,
        Login_Time timestamp,
        Logout_Time timestamp,
        Duration timestamp
        )
        row format delimited
        fields terminated by ','
        ;


        create table agent_performance
        (
        S_no int,
        Date string,
        Agent string,
        Total_chats int,
        Avg_response_time string,
        Avg_resolution_time string,
        Average_Rating float,
        Total_feedback  int
        )
        row format delimited
        fields terminated by ','
        tblproperties("skip.header.line.count"="1")
        ;


        create table agent_performance_csv
        (
        S_no int,
        Date timestamp,
        Agent string,
        Total_chats int,
        Avg_response_time timestamp,
        Avg_resolution_time timestamp,
        Average_Rating float,
        Total_feedback  int
        )
        row format delimited
        fields terminated by ','
        ;



2. Dump the data inside the hdfs in the given schema location.
Ans:
      # load data into tables

      load data inpath 'file:///tmp/hive_class/AgentLogingReport.csv' into table agent_logging;
      load data inpath 'file:///tmp/hive_class/AgentPerformance.csv' into table agent_performance;

      # Overwrite data to get in correct format
      
      insert overwrite table agent_loging_report select s_no,agent, from_unixtime(unix_timestamp(date,'dd-MMM-yy'),'yyyy-MM-dd'),from_unixtime(unix_timestamp(concat(date,login_time),'dd-MMM-yyHH:mm:ss'),'yyyy-MM-dd HH:mm:ss'),from_unixtime(unix_timestamp(concat(date,logout_time),'dd-MMM-yyHH:mm:ss'),'yyyy-MM-dd HH:mm:ss'),from_unixtime(unix_timestamp(concat(date,duration),'dd-MMM-yyHH:mm:ss'),'yyyy-MM-dd HH:mm:ss') from agent_logging;



      insert overwrite table agent_performance_csv select s_no, from_unixtime(unix_timestamp(date, 'MM/dd/yyyy'),'yyyy-MM-dd'), agent, total_chats, from_unixtime(unix_timestamp(concat(date,avg_response_time), 'MM/dd/yyyyHH:mm:ss'),'yyyy-MM-dd HH:mm:ss'), from_unixtime(unix_timestamp(concat(date,avg_resolution_time), 'MM/dd/yyyyHH:mm:ss'),'yyyy-MM-dd HH:mm:ss'), average_rating,total_feedback from agent_performance;  

3. List of all agents' names. 
Ans:
      Query:
      select distinct(agent) from agent_loging_report;
      
      Result:
      
      Aditya Shinde
      Aditya_iot
      Amersh
      Ameya Jain
      Ankitjha
      Anurag Tiwari
      Aravind
      Ayushi Mishra
      Bharath
      Boktiar Ahmed Bappy
      Chaitra K Hiremath
      Deepranjan Gupta
      Dibyanshu
      Harikrishnan Shaji
      Hrisikesh Neogi
      Hyder Abbas
      Ineuron Intelligence
      Ishawant Kumar
      Jawala Prakash
      Jaydeep Dixit
      Khushboo Priya
      Madhulika G
      Mahesh Sarade
      Maitry
      Manjunatha A
      Mithun S
      Mukesh
      Muskan Garg
      Nandani Gupta
      Nishtha Jain
      Nitin M
      Prabir Kumar Satapathy
      Prateek _iot
      Prerna Singh
      Rishav Dash
      Saikumarreddy N
      Sanjeev Kumar
      Saurabh Shukla
      Shiva Srivastava
      Shivan K
      Shivananda Sonwane
      Shubham Sharma
      Sowmiya Sivakumar
      Sudhanshu Kumar
      Suraj S Bilgi
      Swati
      Tarun
      Wasim
      Zeeshan

4. Find out agent average rating.
Ans:
      Query:
      select avg(average_rating) from agent_performance_csv;
      Result:
      1.4609629649255012


5. Total working days for each agents 
Ans:
      Query:
      select agent, count(distinct(date)) as total_working_days from agent_loging_report group by agent;

      Result:

      agent   total_working_days
      Aditya Shinde   1
      Aditya_iot      8
      Amersh  2
      Ameya Jain      7
      Ankitjha        2
      Anurag Tiwari   10
      Aravind 7
      Ayushi Mishra   9
      Bharath 8
      Boktiar Ahmed Bappy     9
      Chaitra K Hiremath      7
      Deepranjan Gupta        10
      Dibyanshu       9
      Harikrishnan Shaji      9
      Hrisikesh Neogi 9
      Hyder Abbas     2
      Ineuron Intelligence    1
      Ishawant Kumar  11
      Jawala Prakash  9
      Jaydeep Dixit   7
      Khushboo Priya  8
      Madhulika G     8
      Mahesh Sarade   8
      Maitry  5
      Manjunatha A    7
      Mithun S        8
      Mukesh  2
      Muskan Garg     6
      Nandani Gupta   9
      Nishtha Jain    8
      Nitin M 1
      Prabir Kumar Satapathy  7
      Prateek _iot    11
      Prerna Singh    9
      Rishav Dash     7
      Saikumarreddy N 7
      Sanjeev Kumar   9
      Saurabh Shukla  4
      Shiva Srivastava        8
      Shivan K        8
      Shivananda Sonwane      10
      Shubham Sharma  11
      Sowmiya Sivakumar       8
      Sudhanshu Kumar 6
      Suraj S Bilgi   2
      Swati   4
      Tarun   1
      Wasim   9
      Zeeshan 9



6. Total query that each agent have taken 
Ans:
      Query:
      select agent, sum(total_chats) as total_query_solved from agent_performance_csv group by agent;

      Result:

      agent   total_query_solved
      Abhishek        0
      Aditya  0
      Aditya Shinde   277
      Aditya_iot      231
      Amersh  0
      Ameya Jain      322
      Anirudh         81
      Ankit Sharma    0
      Ankitjha        5
      Anurag Tiwari   4
      Aravind         366
      Ashad Nasim     18
      Ashish  0
      Ayushi Mishra   514
      Bharath         369
      Boktiar Ahmed Bappy     452
      Chaitra K Hiremath      64
      Deepranjan Gupta        493
      Dibyanshu       1
      Harikrishnan Shaji      381
      Hitesh Choudhary        1
      Hrisikesh Neogi 578
      Hyder Abbas     0
      Ineuron Intelligence    0
      Ishawant Kumar  338
      Jawala Prakash  439
      Jayant Kumar    127
      Jaydeep Dixit   512
      Khushboo Priya  446
      Madhulika G     469
      Mahak   7
      Mahesh Sarade   364
      Maitry  542
      Maneesh         4
      Manjunatha A    413
      Mithun S        503
      Mukesh  19
      Mukesh Rao      5
      Muskan Garg     56
      Nandani Gupta   560
      Nishtha Jain    373
      Nitin M 0
      Prabir Kumar Satapathy  299
      Prateek _iot    190
      Prerna Singh    401
      Rishav Dash     409
      Rohan   0
      Saif Khan       0
      Saikumarreddy N 364
      Samprit         1
      Sandipan Saha   30
      Sanjeev Kumar   507
      Sanjeevan       0
      Saurabh Shukla  16
      Shiva Srivastava        53
      Shivan K        357
      Shivan_S        7
      Shivananda Sonwane      441
      Shubham Sharma  510
      Sowmiya Sivakumar       206
      Spuri   0
      Sudhanshu Kumar 2
      Suraj S Bilgi   28
      Swati   524
      Tarun   22
      Uday Mishra     0
      Vasanth P       0
      Vivek   44
      Wasim   433
      Zeeshan         542

7. Total Feedback that each agent have received 
Ans:
      Query:
      select agent, sum(total_feedback) as total_feedback from agent_performance_csv group by agent;

      Result:

      agent   total_feedback
      Abhishek        0
      Aditya  0
      Aditya Shinde   153
      Aditya_iot      131
      Amersh  0
      Ameya Jain      228
      Anirudh         39
      Ankit Sharma    0
      Ankitjha        3
      Anurag Tiwari   3
      Aravind         233
      Ashad Nasim     9
      Ashish  0
      Ayushi Mishra   329
      Bharath         247
      Boktiar Ahmed Bappy     311
      Chaitra K Hiremath      37
      Deepranjan Gupta        312
      Dibyanshu       0
      Harikrishnan Shaji      231
      Hitesh Choudhary        0
      Hrisikesh Neogi 367
      Hyder Abbas     0
      Ineuron Intelligence    0
      Ishawant Kumar  202
      Jawala Prakash  250
      Jayant Kumar    70
      Jaydeep Dixit   305
      Khushboo Priya  289
      Madhulika G     281
      Mahak   5
      Mahesh Sarade   216
      Maitry  347
      Maneesh         3
      Manjunatha A    254
      Mithun S        364
      Mukesh  17
      Mukesh Rao      5
      Muskan Garg     37
      Nandani Gupta   308
      Nishtha Jain    257
      Nitin M 0
      Prabir Kumar Satapathy  222
      Prateek _iot    107
      Prerna Singh    235
      Rishav Dash     264
      Rohan   0
      Saif Khan       0
      Saikumarreddy N 290
      Samprit         0
      Sandipan Saha   18
      Sanjeev Kumar   311
      Sanjeevan       0
      Saurabh Shukla  8
      Shiva Srivastava        46
      Shivan K        243
      Shivan_S        4
      Shivananda Sonwane      263
      Shubham Sharma  300
      Sowmiya Sivakumar       141
      Spuri   0
      Sudhanshu Kumar 2
      Suraj S Bilgi   15
      Swati   302
      Tarun   6
      Uday Mishra     0
      Vasanth P       0
      Vivek   20
      Wasim   284
      Zeeshan         335

8. Agent name who have average rating between 3.5 to 4 
Ans:
      Query:
      with tab1 as (select agent, avg(average_rating) as avg_rating from agent_performance_csv group by agent) 
      select * from tab1 where tab1.avg_rating between 3.5 and 4;

      Result:
      
      tab1.agent      tab1.avg_rating
      Boktiar Ahmed Bappy     3.567999982833862
      Ishawant Kumar  3.543333347638448
      Khushboo Priya  3.703666663169861
      Manjunatha A    3.5946666876475017



9. Agent name who have rating less than 3.5 
Ans:
      Query:
      with tab1 as (select agent, avg(average_rating) as avg_rating from agent_performance_csv group by agent) 
      select * from tab1 where tab1.avg_rating < 3.5;

      Result:

      tab1.agent      tab1.avg_rating
      Abhishek        0.0
      Aditya  0.0
      Aditya Shinde   1.8003333409627278
      Aditya_iot      2.3453333377838135
      Amersh  0.0
      Ameya Jain      2.21966667175293
      Anirudh         0.6449999968210857
      Ankit Sharma    0.0
      Ankitjha        0.26666666666666666
      Anurag Tiwari   0.18333333333333332
      Aravind         2.1813333511352537
      Ashad Nasim     0.16666666666666666
      Ashish  0.0
      Ayushi Mishra   3.481999969482422
      Bharath         2.9836666584014893
      Chaitra K Hiremath      0.8646666606267294
      Deepranjan Gupta        2.886666695276896
      Dibyanshu       0.0
      Harikrishnan Shaji      2.6396666526794434
      Hitesh Choudhary        0.0
      Hrisikesh Neogi 3.1363333304723104
      Hyder Abbas     0.0
      Ineuron Intelligence    0.0
      Jawala Prakash  3.472000018755595
      Jayant Kumar    1.068666664759318
      Jaydeep Dixit   3.1670000314712525
      Madhulika G     3.4986666520436605
      Mahak   0.1
      Mahesh Sarade   2.4003333330154417
      Maitry  2.9270000139872234
      Maneesh         0.16666666666666666
      Mithun S        2.359000023206075
      Mukesh  0.3096666653951009
      Mukesh Rao      0.25566666523615517
      Muskan Garg     0.712333329518636
      Nandani Gupta   2.9236666679382326
      Nishtha Jain    3.282333334287008
      Nitin M 0.0
      Prabir Kumar Satapathy  2.5103333314259846
      Prateek _iot    2.4383333206176756
      Prerna Singh    3.2326666434605915
      Rishav Dash     1.4268333355585734
      Rohan   0.0
      Saif Khan       0.0
      Saikumarreddy N 1.9803333441416422
      Samprit         0.0
      Sandipan Saha   0.4289999961853027
      Sanjeev Kumar   3.3830000241597493
      Sanjeevan       0.0
      Saurabh Shukla  0.5556666692097981
      Shiva Srivastava        0.9446666717529297
      Shivan K        2.841333341598511
      Shivan_S        0.14166666666666666
      Shubham Sharma  3.2253333568572997
      Sowmiya Sivakumar       1.2599999984105428
      Spuri   0.0
      Sudhanshu Kumar 0.3333333333333333
      Suraj S Bilgi   0.31200000445048015
      Swati   2.4236666917800904
      Tarun   0.05
      Uday Mishra     0.0
      Vasanth P       0.0
      Vivek   0.5006666660308838
      Wasim   2.400000015894572
      Zeeshan         2.286999988555908


10. Agent name who have rating more than 4.5 
Ans:
      Query:
      with tab1 as (select agent, avg(average_rating) as avg_rating from agent_performance_csv group by agent) 
      select * from tab1 where tab1.avg_rating >4.5;

      Result: no agent having rating gretaer than 4.5

11. How many feedback agents have received more than 4.5 average
Ans:
      Query:
      with tab1 as (select agent, avg(average_rating) as avg_rating from agent_performance_csv group by agent) 
      select count(agent) from tab1 where tab1.avg_rating >4.5;
      
      Result:
      _c0
      0



12. average weekly response time for each agent 
Ans:
      Query:
      


13. average weekly resolution time for each agents 
Ans:
      Query:
      


14. Find the number of chat on which they have received a feedback 
Ans:
      Query:
      



15. Total contribution hour for each and every agents weekly basis 
Ans:
      Query:


16. Perform inner join, left join and right join based on the agent column and after joining the table export that data into your local system.
Ans:
      Query:




17. Perform partitioning on top of the agent column and then on top of that perform bucketing for each partitioning.
Ans:
      Query:
